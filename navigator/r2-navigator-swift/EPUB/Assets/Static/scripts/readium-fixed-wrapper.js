(()=>{var __webpack_modules__={653:()=>{eval('//\n//  Copyright 2021 Readium Foundation. All rights reserved.\n//  Use of this source code is governed by the BSD-style license\n//  available in the top-level LICENSE file of the project.\n//\n\n// Script used for the wrapper HTML pages of fixed layouts resources.\n\nwindow.FixedPage = function (iframeId) {\n  // Fixed dimensions for the page, extracted from the viewport meta tag.\n  var _pageSize = null;\n  // Available viewport size to fill with the resource.\n  var _viewportSize = null;\n  // Margins that should not overlap the content.\n  var _safeAreaInsets = null;\n\n  // iFrame containing the page.\n  var _iframe = document.getElementById(iframeId);\n  _iframe.addEventListener("load", loadPageSize);\n\n  // Viewport element containing the iFrame.\n  var _viewport = _iframe.closest(".viewport");\n\n  // Parses the page size from the viewport meta tag of the loaded resource.\n  function loadPageSize() {\n    var viewport = _iframe.contentWindow.document.querySelector(\n      "meta[name=viewport]"\n    );\n    if (!viewport) {\n      return;\n    }\n    var regex = /(\\w+) *= *([^\\s,]+)/g;\n    var properties = {};\n    var match;\n    while ((match = regex.exec(viewport.content))) {\n      properties[match[1]] = match[2];\n    }\n    var width = Number.parseFloat(properties.width);\n    var height = Number.parseFloat(properties.height);\n    if (width && height) {\n      _pageSize = { width: width, height: height };\n      layoutPage();\n    }\n  }\n\n  // Layouts the page iframe to center its content and scale it to fill the available viewport.\n  function layoutPage() {\n    if (!_pageSize || !_viewportSize || !_safeAreaInsets) {\n      return;\n    }\n\n    _iframe.style.width = _pageSize.width + "px";\n    _iframe.style.height = _pageSize.height + "px";\n    _iframe.style.marginTop =\n      _safeAreaInsets.top - _safeAreaInsets.bottom + "px";\n    _iframe.style.marginLeft =\n      _safeAreaInsets.left - _safeAreaInsets.right + "px";\n\n    // Calculates the zoom scale required to fit the content to the viewport.\n    var widthRatio = _viewportSize.width / _pageSize.width;\n    var heightRatio = _viewportSize.height / _pageSize.height;\n    var scale = Math.min(widthRatio, heightRatio);\n\n    // Sets the viewport of the wrapper page (this page) to scale the iframe.\n    var viewport = document.querySelector("meta[name=viewport]");\n    viewport.content = "initial-scale=" + scale + ", minimum-scale=" + scale;\n  }\n\n  return {\n    // Returns whether the page is currently loading its contents.\n    isLoading: false,\n\n    // Link object for the resource currently loaded in the page.\n    link: null,\n\n    // Loads the given resource ({link, url}) in the page.\n    load: function (resource, completion) {\n      if (!resource.link || !resource.url) {\n        if (completion) {\n          completion();\n        }\n        return;\n      }\n\n      var page = this;\n      page.link = resource.link;\n      page.isLoading = true;\n\n      function loaded() {\n        _iframe.removeEventListener("load", loaded);\n\n        // Waiting for the next animation frame seems to do the trick to make sure the page is fully rendered.\n        _iframe.contentWindow.requestAnimationFrame(function () {\n          page.isLoading = false;\n          _iframe.contentWindow.eval(\n            `readium.link = ${JSON.stringify(resource.link)};`\n          );\n          if (completion) {\n            completion();\n          }\n        });\n      }\n\n      _iframe.addEventListener("load", loaded);\n      _iframe.src = resource.url;\n    },\n\n    // Resets the page and empty its contents.\n    reset: function () {\n      if (!this.link) {\n        return;\n      }\n      this.link = null;\n      _pageSize = null;\n      _iframe.src = "about:blank";\n    },\n\n    // Evaluates a script in the context of the page.\n    eval: function (script) {\n      if (!this.link || this.isLoading) {\n        return;\n      }\n      return _iframe.contentWindow.eval(script);\n    },\n\n    // Updates the available viewport to display the resource.\n    setViewport: function (viewportSize, safeAreaInsets) {\n      _viewportSize = viewportSize;\n      _safeAreaInsets = safeAreaInsets;\n      layoutPage();\n    },\n\n    // Shows the page\'s viewport.\n    show: function () {\n      _viewport.style.display = "block";\n    },\n\n    // Hides the page\'s viewport.\n    hide: function () {\n      _viewport.style.display = "none";\n    },\n  };\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9yZWFkaXVtLWpzLy4vc3JjL2luZGV4LWZpeGVkLXdyYXBwZXIuanM/NzM2NCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBLGtDQUFrQyxVQUFVO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLCtCQUErQjtBQUM3RDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EiLCJmaWxlIjoiNjUzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy9cbi8vICBDb3B5cmlnaHQgMjAyMSBSZWFkaXVtIEZvdW5kYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4vLyAgVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJuZWQgYnkgdGhlIEJTRC1zdHlsZSBsaWNlbnNlXG4vLyAgYXZhaWxhYmxlIGluIHRoZSB0b3AtbGV2ZWwgTElDRU5TRSBmaWxlIG9mIHRoZSBwcm9qZWN0LlxuLy9cblxuLy8gU2NyaXB0IHVzZWQgZm9yIHRoZSB3cmFwcGVyIEhUTUwgcGFnZXMgb2YgZml4ZWQgbGF5b3V0cyByZXNvdXJjZXMuXG5cbndpbmRvdy5GaXhlZFBhZ2UgPSBmdW5jdGlvbiAoaWZyYW1lSWQpIHtcbiAgLy8gRml4ZWQgZGltZW5zaW9ucyBmb3IgdGhlIHBhZ2UsIGV4dHJhY3RlZCBmcm9tIHRoZSB2aWV3cG9ydCBtZXRhIHRhZy5cbiAgdmFyIF9wYWdlU2l6ZSA9IG51bGw7XG4gIC8vIEF2YWlsYWJsZSB2aWV3cG9ydCBzaXplIHRvIGZpbGwgd2l0aCB0aGUgcmVzb3VyY2UuXG4gIHZhciBfdmlld3BvcnRTaXplID0gbnVsbDtcbiAgLy8gTWFyZ2lucyB0aGF0IHNob3VsZCBub3Qgb3ZlcmxhcCB0aGUgY29udGVudC5cbiAgdmFyIF9zYWZlQXJlYUluc2V0cyA9IG51bGw7XG5cbiAgLy8gaUZyYW1lIGNvbnRhaW5pbmcgdGhlIHBhZ2UuXG4gIHZhciBfaWZyYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWZyYW1lSWQpO1xuICBfaWZyYW1lLmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsIGxvYWRQYWdlU2l6ZSk7XG5cbiAgLy8gVmlld3BvcnQgZWxlbWVudCBjb250YWluaW5nIHRoZSBpRnJhbWUuXG4gIHZhciBfdmlld3BvcnQgPSBfaWZyYW1lLmNsb3Nlc3QoXCIudmlld3BvcnRcIik7XG5cbiAgLy8gUGFyc2VzIHRoZSBwYWdlIHNpemUgZnJvbSB0aGUgdmlld3BvcnQgbWV0YSB0YWcgb2YgdGhlIGxvYWRlZCByZXNvdXJjZS5cbiAgZnVuY3Rpb24gbG9hZFBhZ2VTaXplKCkge1xuICAgIHZhciB2aWV3cG9ydCA9IF9pZnJhbWUuY29udGVudFdpbmRvdy5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgXCJtZXRhW25hbWU9dmlld3BvcnRdXCJcbiAgICApO1xuICAgIGlmICghdmlld3BvcnQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIHJlZ2V4ID0gLyhcXHcrKSAqPSAqKFteXFxzLF0rKS9nO1xuICAgIHZhciBwcm9wZXJ0aWVzID0ge307XG4gICAgdmFyIG1hdGNoO1xuICAgIHdoaWxlICgobWF0Y2ggPSByZWdleC5leGVjKHZpZXdwb3J0LmNvbnRlbnQpKSkge1xuICAgICAgcHJvcGVydGllc1ttYXRjaFsxXV0gPSBtYXRjaFsyXTtcbiAgICB9XG4gICAgdmFyIHdpZHRoID0gTnVtYmVyLnBhcnNlRmxvYXQocHJvcGVydGllcy53aWR0aCk7XG4gICAgdmFyIGhlaWdodCA9IE51bWJlci5wYXJzZUZsb2F0KHByb3BlcnRpZXMuaGVpZ2h0KTtcbiAgICBpZiAod2lkdGggJiYgaGVpZ2h0KSB7XG4gICAgICBfcGFnZVNpemUgPSB7IHdpZHRoOiB3aWR0aCwgaGVpZ2h0OiBoZWlnaHQgfTtcbiAgICAgIGxheW91dFBhZ2UoKTtcbiAgICB9XG4gIH1cblxuICAvLyBMYXlvdXRzIHRoZSBwYWdlIGlmcmFtZSB0byBjZW50ZXIgaXRzIGNvbnRlbnQgYW5kIHNjYWxlIGl0IHRvIGZpbGwgdGhlIGF2YWlsYWJsZSB2aWV3cG9ydC5cbiAgZnVuY3Rpb24gbGF5b3V0UGFnZSgpIHtcbiAgICBpZiAoIV9wYWdlU2l6ZSB8fCAhX3ZpZXdwb3J0U2l6ZSB8fCAhX3NhZmVBcmVhSW5zZXRzKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgX2lmcmFtZS5zdHlsZS53aWR0aCA9IF9wYWdlU2l6ZS53aWR0aCArIFwicHhcIjtcbiAgICBfaWZyYW1lLnN0eWxlLmhlaWdodCA9IF9wYWdlU2l6ZS5oZWlnaHQgKyBcInB4XCI7XG4gICAgX2lmcmFtZS5zdHlsZS5tYXJnaW5Ub3AgPVxuICAgICAgX3NhZmVBcmVhSW5zZXRzLnRvcCAtIF9zYWZlQXJlYUluc2V0cy5ib3R0b20gKyBcInB4XCI7XG4gICAgX2lmcmFtZS5zdHlsZS5tYXJnaW5MZWZ0ID1cbiAgICAgIF9zYWZlQXJlYUluc2V0cy5sZWZ0IC0gX3NhZmVBcmVhSW5zZXRzLnJpZ2h0ICsgXCJweFwiO1xuXG4gICAgLy8gQ2FsY3VsYXRlcyB0aGUgem9vbSBzY2FsZSByZXF1aXJlZCB0byBmaXQgdGhlIGNvbnRlbnQgdG8gdGhlIHZpZXdwb3J0LlxuICAgIHZhciB3aWR0aFJhdGlvID0gX3ZpZXdwb3J0U2l6ZS53aWR0aCAvIF9wYWdlU2l6ZS53aWR0aDtcbiAgICB2YXIgaGVpZ2h0UmF0aW8gPSBfdmlld3BvcnRTaXplLmhlaWdodCAvIF9wYWdlU2l6ZS5oZWlnaHQ7XG4gICAgdmFyIHNjYWxlID0gTWF0aC5taW4od2lkdGhSYXRpbywgaGVpZ2h0UmF0aW8pO1xuXG4gICAgLy8gU2V0cyB0aGUgdmlld3BvcnQgb2YgdGhlIHdyYXBwZXIgcGFnZSAodGhpcyBwYWdlKSB0byBzY2FsZSB0aGUgaWZyYW1lLlxuICAgIHZhciB2aWV3cG9ydCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJtZXRhW25hbWU9dmlld3BvcnRdXCIpO1xuICAgIHZpZXdwb3J0LmNvbnRlbnQgPSBcImluaXRpYWwtc2NhbGU9XCIgKyBzY2FsZSArIFwiLCBtaW5pbXVtLXNjYWxlPVwiICsgc2NhbGU7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIC8vIFJldHVybnMgd2hldGhlciB0aGUgcGFnZSBpcyBjdXJyZW50bHkgbG9hZGluZyBpdHMgY29udGVudHMuXG4gICAgaXNMb2FkaW5nOiBmYWxzZSxcblxuICAgIC8vIExpbmsgb2JqZWN0IGZvciB0aGUgcmVzb3VyY2UgY3VycmVudGx5IGxvYWRlZCBpbiB0aGUgcGFnZS5cbiAgICBsaW5rOiBudWxsLFxuXG4gICAgLy8gTG9hZHMgdGhlIGdpdmVuIHJlc291cmNlICh7bGluaywgdXJsfSkgaW4gdGhlIHBhZ2UuXG4gICAgbG9hZDogZnVuY3Rpb24gKHJlc291cmNlLCBjb21wbGV0aW9uKSB7XG4gICAgICBpZiAoIXJlc291cmNlLmxpbmsgfHwgIXJlc291cmNlLnVybCkge1xuICAgICAgICBpZiAoY29tcGxldGlvbikge1xuICAgICAgICAgIGNvbXBsZXRpb24oKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHZhciBwYWdlID0gdGhpcztcbiAgICAgIHBhZ2UubGluayA9IHJlc291cmNlLmxpbms7XG4gICAgICBwYWdlLmlzTG9hZGluZyA9IHRydWU7XG5cbiAgICAgIGZ1bmN0aW9uIGxvYWRlZCgpIHtcbiAgICAgICAgX2lmcmFtZS5yZW1vdmVFdmVudExpc3RlbmVyKFwibG9hZFwiLCBsb2FkZWQpO1xuXG4gICAgICAgIC8vIFdhaXRpbmcgZm9yIHRoZSBuZXh0IGFuaW1hdGlvbiBmcmFtZSBzZWVtcyB0byBkbyB0aGUgdHJpY2sgdG8gbWFrZSBzdXJlIHRoZSBwYWdlIGlzIGZ1bGx5IHJlbmRlcmVkLlxuICAgICAgICBfaWZyYW1lLmNvbnRlbnRXaW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBwYWdlLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgIF9pZnJhbWUuY29udGVudFdpbmRvdy5ldmFsKFxuICAgICAgICAgICAgYHJlYWRpdW0ubGluayA9ICR7SlNPTi5zdHJpbmdpZnkocmVzb3VyY2UubGluayl9O2BcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmIChjb21wbGV0aW9uKSB7XG4gICAgICAgICAgICBjb21wbGV0aW9uKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgX2lmcmFtZS5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCBsb2FkZWQpO1xuICAgICAgX2lmcmFtZS5zcmMgPSByZXNvdXJjZS51cmw7XG4gICAgfSxcblxuICAgIC8vIFJlc2V0cyB0aGUgcGFnZSBhbmQgZW1wdHkgaXRzIGNvbnRlbnRzLlxuICAgIHJlc2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoIXRoaXMubGluaykge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLmxpbmsgPSBudWxsO1xuICAgICAgX3BhZ2VTaXplID0gbnVsbDtcbiAgICAgIF9pZnJhbWUuc3JjID0gXCJhYm91dDpibGFua1wiO1xuICAgIH0sXG5cbiAgICAvLyBFdmFsdWF0ZXMgYSBzY3JpcHQgaW4gdGhlIGNvbnRleHQgb2YgdGhlIHBhZ2UuXG4gICAgZXZhbDogZnVuY3Rpb24gKHNjcmlwdCkge1xuICAgICAgaWYgKCF0aGlzLmxpbmsgfHwgdGhpcy5pc0xvYWRpbmcpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgcmV0dXJuIF9pZnJhbWUuY29udGVudFdpbmRvdy5ldmFsKHNjcmlwdCk7XG4gICAgfSxcblxuICAgIC8vIFVwZGF0ZXMgdGhlIGF2YWlsYWJsZSB2aWV3cG9ydCB0byBkaXNwbGF5IHRoZSByZXNvdXJjZS5cbiAgICBzZXRWaWV3cG9ydDogZnVuY3Rpb24gKHZpZXdwb3J0U2l6ZSwgc2FmZUFyZWFJbnNldHMpIHtcbiAgICAgIF92aWV3cG9ydFNpemUgPSB2aWV3cG9ydFNpemU7XG4gICAgICBfc2FmZUFyZWFJbnNldHMgPSBzYWZlQXJlYUluc2V0cztcbiAgICAgIGxheW91dFBhZ2UoKTtcbiAgICB9LFxuXG4gICAgLy8gU2hvd3MgdGhlIHBhZ2UncyB2aWV3cG9ydC5cbiAgICBzaG93OiBmdW5jdGlvbiAoKSB7XG4gICAgICBfdmlld3BvcnQuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICB9LFxuXG4gICAgLy8gSGlkZXMgdGhlIHBhZ2UncyB2aWV3cG9ydC5cbiAgICBoaWRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICBfdmlld3BvcnQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgIH0sXG4gIH07XG59O1xuIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///653\n')}},__webpack_exports__={};__webpack_modules__[653]()})();